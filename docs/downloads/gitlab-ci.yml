# Code generated by gitStream - DO NOT EDIT

# List of stages for jobs, and their order of execution
stages:          
  - gitstream-main
  - gitstream-allow-merge

gitstream-job:
  image: gitlab/dind
  services:
    - docker:dind      
  stage: gitstream-main
  only:
    variables:
      - $GITSTREAM_MAIN_JOB
  except:
    variables:
      - $GITSTREAM_BLOCK_MERGE
  script:
    - git clone https://gitlab-ci-token:${CI_JOB_TOKEN}${repoUrl} gitstream/
    - echo $CI_DEFAULT_BRANCH
    - cd gitstream && git fetch --all && git checkout $CI_DEFAULT_BRANCH && git pull && ls && git checkout $head_ref && git pull && ls
    - docker pull gitstream/rules-engine:latest
    - docker run -v $CI_PROJECT_DIR/gitstream:/code -e HEAD_REF=$head_ref -e BASE_REF=$CI_DEFAULT_BRANCH -e CLIENT_PAYLOAD="$client_payload" -e RULES_RESOLVER_URL=$resolver_url -e RULES_RESOLVER_TOKEN=$resolver_token -e DEBUG_MODE=true  gitstream/rules-engine
    - echo $CI_PROJECT_DIR

gitstream-check-update-job:   
  stage: gitstream-allow-merge
  only:
    variables:
      - $GITSTREAM_UPDATE
  script:
    - |-
      [ ! -z "$GITSTREAM_BLOCK_MERGE" ] && echo $GITSTREAM_BLOCK_MERGE_REASON && exit 1
      